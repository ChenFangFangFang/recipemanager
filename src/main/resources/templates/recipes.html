<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Recipe List</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        h1 {
            font-size: 2rem;
            color: #343a40;
        }

        .btn-primary,
        .btn-info,
        .btn-secondary {
            font-size: 0.9rem;
        }

        .btn-random {
            background-color: #e8c280;
            /* Custom green color */

        }

        .btn-sm {
            margin-right: 5px;
        }

        .table-container {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            background-color: #ffffff;
            padding: 20px;
        }

        .thead-dark th {
            background-color: #343a40;
            color: #ffffff;
        }

        .logout-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 0.9rem;
        }
    </style>
</head>
<script>
    async function getRandomRecipe() {
        try {
            const response = await fetch('/randomrecipe');

            if (response.ok) {
                const recipe = await response.json();
                document.getElementById('recipe-info').textContent =
                    `Title: ${recipe.title}, Description: ${recipe.description}`;
            } else {
                document.getElementById('recipe-info').textContent = 'No recipes found or an error occurred.';
            }
        } catch (error) {
            document.getElementById('recipe-info').textContent = 'Error fetching recipe.';
        }
    }
</script>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Recipe List</h1>

        <!-- Button Container -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <a class="btn btn-primary" th:href="@{/addrecipe}">Add Recipe</a>
                <button class="btn btn-primary" onclick="getRandomRecipe()">Random Recipe</button>

                <a class="btn btn-info" th:href="@{/profile}">Profile</a>
            </div>
        </div>
        <p id="recipe-info" class="text-info font-italic"></p>

        <!-- Table Container -->
        <div class="table-container">
            <table class="table table-bordered table-hover mt-3">
                <thead class="thead-dark">
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Use Times</th>
                        <th>Created Date</th>
                        <th>Tags</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Loop through recipes -->
                    <tr th:each="recipe : ${recipes}">
                        <td th:text="${recipe.id}"></td>
                        <td th:text="${recipe.title}"></td>
                        <td th:text="${recipe.description}"></td>
                        <td th:text="${recipe.useTimes}"></td>
                        <td th:text="${recipe.createdDate?.toLocalDate()}"></td>
                        <td>
                            <!-- Loop through the tags of each recipe -->
                            <span th:each="tag : ${recipe.tags ?: {}}" class="badge badge-info mr-1"
                                th:text="${tag.name ?: 'No Tags'}"></span>
                        </td>
                        <td>
                            <!-- Edit and Delete buttons -->
                            <a class="btn btn-sm btn-warning" th:href="@{'/editrecipe/' + ${recipe.id}}">Edit</a>
                            <form th:action="@{'/deleterecipe/' + ${recipe.id}}" method="post"
                                onsubmit="return confirm('Are you sure you want to delete this recipe?');"
                                class="d-inline">
                                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Logout Button -->
        <a class="btn btn-secondary logout-btn" th:href="@{/logout}">Logout</a>
    </div>
</body>

</html>